# ============================================================================
# N8N Chat Widget - Attachment Support Configuration
# ============================================================================
# This configuration file contains all settings needed for attachment support
# Copy this to your application.properties or application-production.properties
# ============================================================================

# ============================================================================
# FILE UPLOAD CONFIGURATION
# ============================================================================

# Directory where uploaded files will be stored
# Must be writable by the application user
# Example: /var/app/uploads, /tmp/uploads, ./uploads
file.upload.path=/var/app/uploads

# Maximum file size in bytes (default: 100MB = 104857600)
# Increase for larger files, decrease for stricter limits
# Formula: MB * 1024 * 1024
# Examples:
#   50MB  = 52428800
#   100MB = 104857600
#   500MB = 524288000
#   1GB   = 1073741824
file.max.size=104857600

# ============================================================================
# N8N WEBHOOK CONFIGURATION
# ============================================================================

# N8N webhook URL for chat processing
# This is where chat requests (with attachments) will be sent
# Format: https://{n8n-instance}/webhook/{workflow-id}
# Example: https://n8n.example.com/webhook/chatbot-workflow
# Important: Must be accessible from your Chat API server
n8n.webhook.knowledgebase.chat.url=https://your-n8n-instance.com/webhook/your-workflow

# Optional: N8N Authentication (if your webhook requires it)
# n8n.webhook.auth.token=your-secret-token
# n8n.webhook.auth.username=admin
# n8n.webhook.auth.password=password

# Optional: N8N timeout in seconds (default: 30)
# n8n.webhook.timeout=30

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================

# Server port
server.port=8080

# Application context path
server.servlet.context-path=/

# Maximum HTTP POST size (should match or exceed file.max.size)
# This prevents "413 Payload Too Large" errors
# Use same value as file.max.size or slightly larger
server.tomcat.max-http-post-size=104857600

# Request timeout in milliseconds (default: 30000 = 30 seconds)
server.tomcat.connection-timeout=30000

# Maximum threads for handling requests
# Increase for higher concurrency, decrease for lower memory usage
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10

# ============================================================================
# FILE STORAGE CLEANUP (Optional)
# ============================================================================

# Enable automatic cleanup of old files
file.cleanup.enabled=false

# Delete files older than this many days (default: 30)
file.cleanup.days=30

# Cleanup schedule (cron expression)
# Format: "second minute hour day month weekday"
# Examples:
#   "0 2 * * *"      = Every day at 2:00 AM
#   "0 */6 * * *"    = Every 6 hours
#   "0 0 1 * *"      = Monthly (1st day at midnight)
file.cleanup.schedule=0 2 * * *

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================

# Allowed MIME types (comma-separated)
# Only files with these types will be accepted
# If not specified, uses default whitelist
security.allowed-mime-types=application/pdf,text/plain,text/csv,application/json,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.openxmlformats-officedocument.presentationml.presentation,image/jpeg,image/png,image/gif,image/webp,image/svg+xml

# Enable strict filename validation (recommended: true)
security.strict-filename-validation=true

# Maximum attachment count per request (default: 10)
security.max-attachments-per-request=10

# Session storage quota in bytes (default: unlimited)
# Set per-session limit to prevent abuse
# Example: 1GB = 1073741824
security.session-storage-quota=

# ============================================================================
# MONGODB CONFIGURATION
# ============================================================================

# MongoDB connection URI
# Format: mongodb://[user:password@]host:port[/database]
# Examples:
#   mongodb://localhost:27017/chatbot_db
#   mongodb://mongo:27017/chatbot_db (Docker)
#   mongodb+srv://user:password@cluster.mongodb.net/chatbot_db (Atlas)
spring.data.mongodb.uri=mongodb://localhost:27017/chatbot_db

# Alternative: Individual MongoDB properties
# spring.data.mongodb.host=localhost
# spring.data.mongodb.port=27017
# spring.data.mongodb.database=chatbot_db
# spring.data.mongodb.username=user
# spring.data.mongodb.password=password

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================

# Log level for attachment operations
logging.level.net.ai.chatbot.service.n8n=INFO
logging.level.net.ai.chatbot.utils=INFO
logging.level.net.ai.chatbot.controller=INFO

# Log file location (optional)
# logging.file.name=/var/log/chatbot-api/app.log
# logging.file.max-size=10MB
# logging.file.max-history=30

# ============================================================================
# CORS CONFIGURATION
# ============================================================================

# Allow all origins for CORS (development only)
# In production, restrict to your frontend domain
# Value format: origin1,origin2,origin3
# Examples:
#   http://localhost:3000
#   https://app.example.com
#   https://*.example.com (wildcard not directly supported, use separate entries)

# ============================================================================
# PERFORMANCE TUNING
# ============================================================================

# Connection pool size for database
# spring.datasource.hikari.maximum-pool-size=20
# spring.datasource.hikari.minimum-idle=5

# Cache configuration (optional)
# spring.cache.type=redis
# spring.redis.host=localhost
# spring.redis.port=6379

# ============================================================================
# ACTUATOR/HEALTH CHECK
# ============================================================================

# Enable Spring Boot Actuator (for monitoring)
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized

# ============================================================================
# EXAMPLE CONFIGURATIONS
# ============================================================================

# --- Development Configuration ---
# file.upload.path=./uploads
# file.max.size=52428800
# logging.level.root=DEBUG

# --- Staging Configuration ---
# file.upload.path=/opt/app/uploads
# file.max.size=104857600
# security.session-storage-quota=1073741824
# logging.level.root=INFO

# --- Production Configuration ---
# file.upload.path=/var/data/app/uploads
# file.max.size=104857600
# file.cleanup.enabled=true
# file.cleanup.days=30
# security.session-storage-quota=5368709120
# logging.level.root=WARN

# ============================================================================
# NOTES
# ============================================================================

# 1. File Paths:
#    - Use absolute paths for production
#    - Ensure directory exists and is writable
#    - Example: mkdir -p /var/app/uploads && chown appuser /var/app/uploads

# 2. File Size:
#    - Default 100MB supports most documents and images
#    - Increase for video/large files
#    - Remember: Base64 encoding increases size by ~33%

# 3. N8N Webhook:
#    - Must be accessible from Chat API server
#    - Test with: curl -X POST {webhook-url} -H "Content-Type: application/json"
#    - Add authentication if webhook requires it

# 4. Server Size:
#    - Increase max-http-post-size if getting 413 errors
#    - Increase tomcat threads for higher concurrency

# 5. Cleanup:
#    - Enable for production to prevent disk space issues
#    - Adjust days and schedule based on your needs

# 6. Security:
#    - Review MIME type whitelist
#    - Enable strict filename validation
#    - Set session storage quota to prevent abuse

# ============================================================================
# DOCKER ENVIRONMENT VARIABLES
# ============================================================================

# If using Docker, set environment variables instead:
# docker run -e FILE_UPLOAD_PATH=/app/uploads \
#            -e FILE_MAX_SIZE=104857600 \
#            -e N8N_WEBHOOK_KNOWLEDGEBASE_CHAT_URL=http://n8n:5678/webhook/chat \
#            chatbot-api:latest

# ============================================================================
# FOR MORE INFORMATION
# ============================================================================

# API Documentation:    N8N_ATTACHMENT_API_DOCUMENTATION.md
# Implementation Guide: N8N_ATTACHMENT_IMPLEMENTATION_GUIDE.md
# Quick Start:          QUICK_START_ATTACHMENTS.md
# Summary:              ATTACHMENT_IMPLEMENTATION_SUMMARY.md

# ============================================================================

